module Tools

import Books

const project_root = dirname(dirname(pathof(Tools)))
const build_dir = joinpath(project_root, "build")

function git_version_text()
    io = IOBuffer()
    cmd = `git rev-parse HEAD`
    run(pipeline(cmd; stdout=io))
    out = String(take!(io))
    hash = strip(out)
    text = """
    This document is generated by <https://github.com/rikhuijzer/tools> at commit `$hash`.
    """
    path = joinpath(build_dir, "git-commit.md")
    write(path, text)
    text
end

function build_all()
    rm(build_dir; force=true, recursive=true)
    mkpath(build_dir)
    git_version_text()
    Books.build_all()
end

end # module
